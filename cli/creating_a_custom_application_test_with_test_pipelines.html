<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Creating a Custom Application Test with Test Pipelines :: HACBS Documentation</title>
    <link rel="canonical" href="http://localhost:8080/cli/creating_a_custom_application_test_with_test_pipelines.html">
    <meta name="generator" content="Antora 3.1.2">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="stylesheet" href="../_/css/main.css">
    <script>var uiRootPath = '../_'</script>
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="http://localhost:8080">HACBS Documentation</a>

      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
              <div class="button"><a href="https://gitlab.cee.redhat.com/red-hat-hybrid-application-cloud-build-services-documentation/hacbs-documentation/-/issues/new" target="_blank">Raise an issue</a></div>
        <div class="navbar-item search hide-for-print">
          <div id="search-field" class="field">
            <input id="search-input" type="text" placeholder="Search the docs">
            <label class="filter checkbox">
              <input type="checkbox" data-facet-filter="component:ROOT"> In this project
            </label>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ROOT" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">ROOT</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../getting-started/index.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/build_service.html">Pipeline customization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/pipeline_visualization.html">Pipeline visualization</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../how-to-guides/index.html">How-to guides</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../how-to-guides/delete_application.html">Deleting an application from UI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../how-to-guides/proc_creating_static_environment.html">Creating a static environment</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">CLI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="proc_release_application.html">Releasing an application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="proc_managed_services_onboarding.html">Managed services team onboarding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="delete_application.html">Deleting an application from CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="proc_enabled_java_dependencies.html">Configuring Java builds with enabled dependencies rebuild</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="proc_disabled_java_dependencies.html">Configuring Java builds with disabled dependencies rebuild</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="creating_a_custom_application_test_with_test_pipelines.html">Creating a custom application test with test pipelines</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../concepts/index.html">Concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/release-services/con_release-services-overview.html">Release Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/enterprise-contract/con_enterprise-contract-overview.html">Enterprise Contract</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../concepts/testing_applications/index.html">Testing Applications</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../concepts/testing_applications/sanity_tests.html">Sanity Tests</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../concepts/testing_applications/adding_new_tests.html">Add a New Test</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../concepts/testing_applications/configuring_tests.html">Configuring Tests</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../concepts/pipelines/index.html">Pipelines</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../concepts/pipelines/persister.html">Persister component</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../concepts/pipelines/pipeline_concepts.html">Pipeline concepts</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/environments/index.html">Environments</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/java-build-service/java-build-service.html">Java build service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/java-build-service/java-build-service-components.html">Java build service components</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../glossary/index.html">Glossary</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../contribute/index.html">Contribute to documentation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../raise-issue/index.html">Raise an issue</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../support/index.html">Support</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">ROOT</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../ec-cli/main/index.html">Enterprise Contract CLI</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../ec-cli/main/index.html">main</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../ec-policies/index.html">Enterprise Contract Policies</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../ec-policies/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">ROOT</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">ROOT</a></li>
    <li><a href="index.html">CLI</a></li>
    <li><a href="creating_a_custom_application_test_with_test_pipelines.html">Creating a custom application test with test pipelines</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/gtrivedi/git/HACBS/stonesoup-documentation/modules/ROOT/pages/cli/creating_a_custom_application_test_with_test_pipelines.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Creating a Custom Application Test with Test Pipelines</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_how_integration_services_use_tekton_test_pipelines_and_test_scenarios">1. How integration services use Tekton test pipelines and test scenarios</a></li>
<li><a href="#_creating_an_individual_tekton_task">2. Creating an individual Tekton task</a></li>
<li><a href="#_creating_a_tekton_bundle_image">3. Creating a Tekton bundle image</a></li>
<li><a href="#_creating_an_integration_test_scenario">4. Creating an integration test scenario</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_how_integration_services_use_tekton_test_pipelines_and_test_scenarios"><a class="anchor" href="#_how_integration_services_use_tekton_test_pipelines_and_test_scenarios"></a>1. How integration services use Tekton test pipelines and test scenarios</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To create a custom application test, you must create a Tekton test pipeline. The test pipeline consists of a single definition that could be executed as two logically distinct pipeline runs by the Integration Service. The Integration Service executes the test pipeline and tests the application. The Integration Service has two different stages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Component stage: when you build a single component image, the Integration Service tests the application using only that components updated to use the newly built image.</p>
</li>
<li>
<p>Composite stage: when you build multiple components at the same time, the Integration Service tests the application, using multiple components updated to use the newly built images.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A new custom resource (CR) called <code>IntegrationTestScenario</code> describes separate PipelineRuns that run by the snapshot controller. Each IntegrationTestScenario includes information regarding the executed Tekton pipeline:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Tekton bundle image</p>
</li>
<li>
<p>The pipeline name and paramaters</p>
</li>
<li>
<p>The environment details</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use the IntegrationTestScenario to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify where the pipeline will be applied</p>
</li>
<li>
<p>Define if the test scenario runs in the component stage, the composite stage, or both</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The ephemeral environment is the copy of an existing environment that the Integration Service created for a specific integration pipeline run. When the Integration Service creates an ephemeral environment, it creates the following actions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Integration Service creates the, <code>ApplicationSnapshotEnvironmentBinding</code> that links the <code>ApplicationSnapshot</code> with the <code>Environment</code>.</p>
</li>
<li>
<p>The GitOps service deploys the Snapshot on the new Environment</p>
</li>
<li>
<p>The Integration Service links the credentials for the <code>Environment</code> to the <code>Integration Tekton pipeline run</code>.</p>
</li>
<li>
<p>The Integration Service starts the test run.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To create a custom application test, go to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Creating a Tekton bundle image</p>
</li>
<li>
<p>Creating an individual Tekton task</p>
</li>
<li>
<p>Creating an integration test scenario</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_an_individual_tekton_task"><a class="anchor" href="#_creating_an_individual_tekton_task"></a>2. Creating an individual Tekton task</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An individual Tekton task contains the results that the Integration Service reads.</p>
</div>
<div class="olist arabic">
<div class="title">Proceudre</div>
<ol class="arabic">
<li>
<p>In your framework, build your Tekton task containing the standardized HACBS Tekton task output (HACBS_TEST_OUTPUT) which is saved as the result of the Task:</p>
<div class="listingblock">
<div class="content">
<pre>apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: test-output
spec:
  results:
    - name: HACBS_TEST_OUTPUT
      description: Test output
  params:
    - default: "SUCCESS"
      name: RESULT
      description: Test result to be generated
  steps:
    - image: quay.io/redhat-appstudio/hacbs-test:stable
      script: |
        HACBS_TEST_OUTPUT=$(jq -rc --arg date $(date +%s) --arg RESULT $(params.RESULT) --null-input \
          '{result: $RESULT, timestamp: $date, failures: 0, successes: 0}')
        echo "${HACBS_TEST_OUTPUT}" | tee $(results.HACBS_TEST_OUTPUT.path)</pre>
</div>
</div>
</li>
<li>
<p>Store the output in the Task’s workspace under the name convention, <code>test_name_output.json</code>.</p>
</li>
<li>
<p>Push the Tekton bundle image into your designated repository:</p>
<div class="listingblock">
<div class="content">
<pre>tkn bundle push quay.io/YOUR_REPO_HERE/test-bundle:test-output -f tasks/tekton_task.yaml</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_a_tekton_bundle_image"><a class="anchor" href="#_creating_a_tekton_bundle_image"></a>3. Creating a Tekton bundle image</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create a Tekton bundle image to package a pipeline. In order to make a Tekton bundle, the Tekton tasks must point to Tekton bundle images. After you package the pipeline, the Integration Service can run it as a bundle. Both the Build and Release Service utilize bundles.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Build the Tekton pipeline definition yaml into the Tekton bundle image:</p>
<div class="listingblock">
<div class="content">
<pre>apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: component-pipeline-pass
spec:
  tasks:
    - name: task-success
      taskRef:
        name: test-output
        bundle: quay.io/redhat-appstudio/example-tekton-bundle:test-output
      params:
        - name: RESULT
          value: SUCCESS
    - name: task-success-2
      taskRef:
        name: test-output
        bundle: quay.io/redhat-appstudio/example-tekton-bundle:test-output
      params:
        - name: RESULT
          value: SUCCESS
    - name: task-skipped
      taskRef:
        name: test-output
        bundle: quay.io/redhat-appstudio/example-tekton-bundle:test-output
      params:
        - name: RESULT
          value: SKIPPED</pre>
</div>
</div>
</li>
<li>
<p>Push the Tekton bundle image into your designated repository:</p>
<div class="listingblock">
<div class="content">
<pre>tkn bundle push quay.io/YOUR_REPO_HERE/test-bundle:build-pipeline-pass -f pipelines/build_pipeline_pass.yaml</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_an_integration_test_scenario"><a class="anchor" href="#_creating_an_integration_test_scenario"></a>4. Creating an integration test scenario</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create an IntegrationTestScenario so that the Integration Service can test your application components.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Define the test scenario by specifying the following:</p>
<div class="ulist">
<ul>
<li>
<p>Name for the test scenario</p>
</li>
<li>
<p>Tekton bundle image for the test scenario</p>
</li>
<li>
<p>Name of the pipeline located in the Tekton bundle image</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Optional:</strong> define the test scenario by specifying the following:</p>
<div class="ulist">
<ul>
<li>
<p>If the test scenario is optional or mandatory</p>
</li>
<li>
<p>The contexts for the test scenario, such as: component, composite, or both</p>
</li>
</ul>
</div>
</li>
<li>
<p>Define the environment by specifying the following:</p>
<div class="ulist">
<ul>
<li>
<p>The name of the environment that creates an ephemeral testing environment</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer" style="text-align: center;">
    <a href="https://gitlab.cee.redhat.com/red-hat-stone-soup/stonesoup-documentation/-/blob/main/modules/ROOT/pages">Source documents on GitLab</a>
    | <a href="https://docs.engineering.redhat.com/pages/viewpage.action?pageId=256849149">Engage with us!</a>
    | <a href="link:https://groups.google.com/g/stonesoup">Contact us on Google Chat</a>
</footer>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async src="../_/js/vendor/highlight.js"></script>
<script src="../_/js/vendor/lunr.js"></script>
<script src="../_/js/search-ui.js" id="search-ui-script" data-site-root-path=".." data-snippet-length="100" data-stylesheet="../_/css/search.css"></script>
<script async src="../search-index.js"></script>
  </body>
</html>
